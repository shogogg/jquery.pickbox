(function(a,f,b){var j,m,d,i,e,l,k,o,n,h,c,g;n=13;o=27;h=38;k=40;c=100;i=150;l=300;e="ui-pickbox-index";j="ui-pickbox-btn-hovered";d="ui-pickbox-list-item-hovered";m="ui-pickbox-input-focused";g={box:null,btn:null,list:null,items:null,input:null,wrapper:null,lastValue:null,watchTimer:null,closeDelayTimer:null,filterDelayTimer:null,options:null,_init:function(){var r,p,q,s=this;r=this.element.hide();q=r.children();p=q.map(function(){var t;t=this.innerHTML;if(t.length<=0){t="&nbsp;"}return'<li class="ui-pickbox-list-item">'+t+"</li>"});this.btn=f('<button type="button" class="ui-pickbox-btn">').click(function(){return s.toggle()}).mouseover(function(){return s.btn.addClass(j)}).mouseout(function(){return s.btn.removeClass(j)}).text(q.filter(":selected").text()).insertAfter(r);this.input=f('<input type="text" class="ui-pickbox-input">').keydown(function(t){return s._onKeyInput(t)}).focus(function(){s.input.addClass(m);s._startWatcher()}).blur(function(){s.input.removeClass(m);s._close()});this.list=f('<ul class="ui-pickbox-list">').html(p.get().join(""));this.items=this.list.children().click(function(t){return s._select(t.currentTarget)}).mouseover(function(){return f(this).addClass(d)}).mouseout(function(){return f(this).removeClass(d)}).each(function(t){return f.data(this,e,t)});this.wrapper=f('<div class="ui-pickbox-list-wrapper">').css("position","relative").append(this.list);this.box=f('<form class="ui-pickbox">').append(this.input).append(this.wrapper).hide().appendTo("body")},toggle:function(){if(this.box.is(":visible")){return this.close()}else{return this.open()}},open:function(){var q,p,r,s=this;r=this.btn.offset();this.box.css({top:r.top+this.btn.outerHeight()+1,left:r.left});this.box.show(0,function(){return s._hoverByIndex(s.element[0].selectedIndex)});q=this.box.innerWidth();p=this.input.outerWidth()-this.input.innerWidth();this.input.focus().width(q-p)},close:function(){var p=this;if(this.watchTimer){a.clearInterval(this.watchTimer)}if(this.closeDelayTimer){a.clearTimeout(this.closeDelayTimer)}this.box.hide(0,function(){return p.btn.focus()})},_close:function(){var q,p=this;if(this.closeDelayTimer){a.clearTimeout(this.closeDelayTimer)}q=function(){p.close()};this.closeDelayTimer=a.setTimeout(q,i)},_select:function(p){p=f(p);if(p.length!==0){this.element.get(0).selectedIndex=f.data(p[0],e);this.btn.text(p.text());this.close()}},_selectByIndex:function(p){this._select(this.items.get(p))},_onKeyInput:function(q){var p;p=b;switch(q.keyCode){case h:p=this._getSelected().removeClass(d).prevAll().filter(":visible:first");if(p.length===0){p=this.items.filter(":visible:last")}break;case k:p=this._getSelected().removeClass(d).nextAll().filter(":visible:first");if(p.length===0){p=this.items.filter(":visible:first")}break;case n:this._select(this._getSelected());break;case o:this.close();break;default:return true}if(p&&p.length!==0){this._hover(p)}q.preventDefault();q.stopPropagation();return false},_hover:function(q){var p,t,s,u,r;f("."+d).removeClass(d);q.addClass(d);s=q.position().top;u=this.wrapper;p=q.outerHeight();r=u.height();t=u.scrollTop();if(s<0){u.scrollTop(t+s)}else{if(s+p>r){u.scrollTop(t+s+p-r)}}},_hoverByIndex:function(p){this._hover(this.items.eq(p))},_getSelected:function(){return this.items.filter("."+d+":first")},_startWatcher:function(){var p,q=this;p=function(){var r;r=q.input.val();if(r!==q.lastValue){q._filterItems(r)}};this.watchTimer=a.setInterval(p,c)},_filterItems:function(q){var p,r=this;p=this.items;this.lastValue=q;if(this.filterDelayTimer){a.clearTimeout(this.filterDelayTimer)}if(q.length<=0){p.show()}else{this.filterDelayTimer=a.setTimeout(function(){r._hover(p.hide().filter(":contains("+q+")").show().eq(0))},l)}}};f.widget("ui.pickbox",g)})(window,jQuery);
(function(a,f,b){var j,d,i,e,l,k,n,m,h,c,g;m=13;n=27;h=38;k=40;c=100;i=150;l=300;e="ui-pickbox-index";j="ui-pickbox-btn-hovered";d="ui-pickbox-list-item-hovered";g={box:null,btn:null,list:null,items:null,input:null,wrapper:null,lastValue:null,watchTimer:null,closeDelayTimer:null,filterDelayTimer:null,options:null,_init:function(){var q,o,p,r=this;q=this.element.hide();p=q.children();o=p.map(function(){var s;s=this.innerHTML;if(s.length<=0){s="&nbsp;"}return'<li class="ui-pickbox-list-item">'+s+"</li>"});this.btn=f('<button type="button" class="ui-pickbox-btn">').click(function(){return r.toggle()}).mouseover(function(){return r.btn.addClass(j)}).mouseout(function(){return r.btn.removeClass(j)}).text(p.filter(":selected").text()).insertAfter(q);this.input=f('<input type="text" class="xui-pickbox-input">').keydown(function(s){return r._onKeyInput(s)}).focus(function(){return r._startWatcher()}).blur(function(){return r._close()});this.list=f('<ul class="ui-pickbox-list">').html(o.get().join(""));this.items=this.list.children().click(function(s){return r._select(s.currentTarget)}).mouseover(function(){return f(this).addClass(d)}).mouseout(function(){return f(this).removeClass(d)}).each(function(s){return f.data(this,e,s)});this.wrapper=f('<div class="ui-pickbox-list-wrapper">').css("position","relative").append(this.list);this.box=f('<form class="ui-pickbox">').append(this.input).append(this.wrapper).hide().appendTo("body")},toggle:function(){if(this.box.is(":visible")){return this.close()}else{return this.open()}},open:function(){var o,p=this;o=this.btn.offset();this.box.css({top:o.top+this.btn.outerHeight()+1,left:o.left});this.box.show(0,function(){return p._hoverByIndex(p.element[0].selectedIndex)});this.input.focus()},close:function(){var o=this;if(this.watchTimer){a.clearInterval(this.watchTimer)}if(this.closeDelayTimer){a.clearTimeout(this.closeDelayTimer)}this.box.hide(0,function(){return o.btn.focus()})},_close:function(){var p,o=this;if(this.closeDelayTimer){a.clearTimeout(this.closeDelayTimer)}p=function(){o.close()};this.closeDelayTimer=a.setTimeout(p,i)},_select:function(o){o=f(o);if(o.length!==0){this.element.get(0).selectedIndex=f.data(o[0],e);this.btn.text(o.text());this.close()}},_selectByIndex:function(o){this._select(this.items.get(o))},_onKeyInput:function(p){var o;o=b;switch(p.keyCode){case h:o=this._getSelected().removeClass(d).prevAll().filter(":visible:first");if(o.length===0){o=this.items.filter(":visible:last")}break;case k:o=this._getSelected().removeClass(d).nextAll().filter(":visible:first");if(o.length===0){o=this.items.filter(":visible:first")}break;case m:this._select(this._getSelected());break;case n:this.close();break;default:return true}if(o&&o.length!==0){this._hover(o)}p.preventDefault();p.stopPropagation();return false},_hover:function(p){var o,s,r,t,q;f("."+d).removeClass(d);p.addClass(d);r=p.position().top;t=this.wrapper;o=p.outerHeight();q=t.height();s=t.scrollTop();if(r<0){t.scrollTop(s+r)}else{if(r+o>q){t.scrollTop(s+r+o-q)}}},_hoverByIndex:function(o){this._hover(this.items.eq(o))},_getSelected:function(){return this.items.filter("."+d+":first")},_startWatcher:function(){var o,p=this;o=function(){var q;q=p.input.val();if(q!==p.lastValue){p._filterItems(q)}};this.watchTimer=a.setInterval(o,c)},_filterItems:function(p){var o,q=this;o=this.items;this.lastValue=p;if(this.filterDelayTimer){a.clearTimeout(this.filterDelayTimer)}if(p.length<=0){o.show()}else{this.filterDelayTimer=a.setTimeout(function(){q._hover(o.hide().filter(":contains("+p+")").show().eq(0))},l)}}};f.widget("ui.pickbox",g)})(window,jQuery);